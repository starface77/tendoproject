import{c as A,r as b,j as e,h as k,B as I,f as g,d as E,u as L,q as p,i as T,g as f}from"./index-U3rPQCjX.js";const B=({product:s,variant:n="default",className:j="",showQuantity:u=!1,compact:$=!1})=>{const{addToCart:y,items:N}=A(),[o,w]=b.useState(!1),[a,i]=b.useState(!1),d=N.find(r=>r.id===s.id),m=(d==null?void 0:d.quantity)||0,x=async()=>{if(!o){w(!0);try{await y(s),i(!0),setTimeout(()=>i(!1),2e3)}catch(r){console.error("Ошибка добавления в корзину:",r)}finally{w(!1)}}},v=()=>a?e.jsxs("div",{className:"flex items-center justify-center space-x-2 animate-pulse",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:"Добавлено!"})]}):o?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Добавляем..."})]}):n==="compact"?e.jsx(I,{className:"h-4 w-4"}):n==="icon"?e.jsx(g,{className:"h-5 w-5"}):e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{children:"В корзину"}),u&&m>0&&e.jsx("span",{className:"ml-2 bg-white/20 px-2 py-1 rounded-full text-xs",children:m})]}),h=()=>{const r="inline-flex items-center justify-center font-medium rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2";return a?`${r} bg-green-500 text-white hover:bg-green-600`:n==="compact"?`${r} w-8 h-8 bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-300`:n==="icon"?`${r} w-10 h-10 bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-300`:n==="full"?`${r} w-full px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 border border-blue-700`:`${r} px-3 py-2 bg-blue-600 text-white hover:bg-blue-700 border border-blue-700`};return e.jsx("button",{onClick:x,disabled:o||a,className:`${h()} ${j} ${o||a?"cursor-not-allowed opacity-90":""}`,title:a?"Товар добавлен в корзину":"Добавить в корзину",children:v()})},q=({product:s})=>{var C;const[n,j]=b.useState(!1),[u,$]=b.useState(!1),{addToWishlist:y,removeFromWishlist:N,isInWishlist:o}=E(),{t:w}=L(),a=(s==null?void 0:s.id)||(s==null?void 0:s._id),i=o(a),d=async()=>{i?await N(a):await y({id:a,name:r(s.name),price:s.price,image:x(s.images||s.image),rating:s.rating||0})},m=()=>{j(!0)},x=t=>{if(!t)return null;if(Array.isArray(t)){if(t.length===0)return null;const l=t[0];return typeof l=="object"?(l==null?void 0:l.url)||(l==null?void 0:l.src):l}return typeof t=="object"?(t==null?void 0:t.url)||(t==null?void 0:t.src):t},v=()=>{$(!0)},h=t=>new Intl.NumberFormat("ru-RU").format(t)+" сум",r=t=>typeof t=="string"?t:typeof t=="object"&&t!==null&&(t.ru||t.en||t.uz)||"Без названия",P=t=>{const l=[],F=Math.floor(t),S=t%1!==0;for(let c=0;c<5;c++)c<F?l.push(e.jsx(f,{className:"w-3 h-3 text-yellow-400 fill-current"},c)):c===F&&S?l.push(e.jsx(f,{className:"w-3 h-3 text-yellow-400 fill-current opacity-50"},c)):l.push(e.jsx(f,{className:"w-3 h-3 text-gray-300"},c));return l};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden hover:shadow-lg hover:border-blue-300 transition-all duration-200 flex flex-col h-full",children:[e.jsxs("div",{className:"relative aspect-square overflow-hidden bg-gray-50",children:[!n&&!u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-200 border-t-blue-600 rounded-full animate-spin"})}),e.jsx(p,{to:`/product/${a}`,className:"block",children:x(s.images||s.image)?e.jsx("img",{src:x(s.images||s.image),alt:r(s.name),className:`w-full h-full object-cover transition-opacity duration-200 ${n?"opacity-100":"opacity-0"}`,onLoad:m,onError:v}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(g,{className:"h-6 w-6 text-gray-400"})})})}),u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(g,{className:"h-6 w-6 text-gray-400"})})}),s.badge&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:s.badge})}),s.discount&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs("span",{className:"bg-red-500 text-white px-2 py-1 rounded text-xs font-medium",children:["-",s.discount,"%"]})}),e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),d()},"aria-label":i?"Удалить из избранного":"В избранное",className:`absolute top-2 right-2 w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center ${i?"bg-red-500 text-white":"bg-white/80 backdrop-blur text-gray-400 hover:text-red-500"} shadow-sm`,children:e.jsx(T,{className:`w-3 h-3 sm:w-4 sm:h-4 ${i?"fill-current":""}`})})]}),e.jsxs("div",{className:"p-2 sm:p-3 space-y-1.5 sm:space-y-2 flex-1 flex flex-col",children:[e.jsx(p,{to:`/product/${a}`,className:"block hover:text-blue-600 transition-colors flex-1",children:e.jsx("h3",{className:"font-medium text-gray-900 line-clamp-2 text-xs sm:text-sm leading-tight",children:r(s.name)})}),s.seller&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[e.jsx("span",{children:"Продавец:"}),e.jsx(p,{to:`/seller/${s.seller._id||s.seller.id}`,className:"font-medium text-blue-600 hover:text-blue-700 truncate transition-colors",children:s.seller.name||s.seller.storeName||"Магазин"}),s.seller.verified&&e.jsx(f,{className:"h-3 w-3 text-yellow-500 fill-current"})]}),(s.rating||0)>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"flex space-x-0.5",children:P(s.rating||0)}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2 hidden sm:inline font-medium",children:[(C=s.rating)==null?void 0:C.toFixed(1)," (",s.reviewCount||0,")"]})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[e.jsx("span",{className:"text-sm sm:text-base font-bold text-gray-900 truncate",children:h(s.price)}),s.originalPrice&&s.originalPrice>s.price&&e.jsx("span",{className:"text-xs text-gray-400 line-through hidden sm:inline",children:h(s.originalPrice)})]})}),e.jsx("div",{className:"mt-auto pt-1 sm:pt-2",children:e.jsx(B,{product:s,variant:"full",className:"w-full text-xs sm:text-sm py-1.5 sm:py-2 bg-blue-600 hover:bg-blue-700 text-white rounded"})})]})]})};export{q as P};
