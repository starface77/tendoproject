import{u as L,b as B,c as Q,z as R,r as h,j as e,e as M,H as Y,l as T,D as U,h as W,I as p}from"./index-U3rPQCjX.js";const K=()=>{var I,_,S;const{t:r}=L(),m=B(),{cartItems:i,getTotalPrice:y,clearCart:P}=Q(),{isAuthenticated:b,user:n}=R(),[l,u]=h.useState(1),[j,v]=h.useState(!1),[a,A]=h.useState({address:{firstName:(n==null?void 0:n.firstName)||"",lastName:(n==null?void 0:n.lastName)||"",phone:(n==null?void 0:n.phone)||"",city:(n==null?void 0:n.city)||"tashkent",street:"",house:"",apartment:"",entrance:"",floor:"",intercom:"",comment:""},delivery:{type:"courier",date:"",timeSlot:"",cost:0},payment:{method:"card",cardNumber:"",cardName:"",cardExpiry:"",cardCvv:""}}),N=[{value:"tashkent",name:r("tashkent","Ташкент")},{value:"samarkand",name:r("samarkand","Самарканд")},{value:"bukhara",name:r("bukhara","Бухара")},{value:"andijan",name:r("andijan","Андижан")},{value:"namangan",name:r("namangan","Наманган")}],f=[{type:"courier",name:r("courier_delivery","Курьерская доставка"),description:r("courier_description","Доставка в течение 1-3 дней"),cost:25e3,icon:"🚚"},{type:"pickup",name:r("pickup_delivery","Самовывоз"),description:r("pickup_description","Забрать из пункта выдачи"),cost:0,icon:"📦"},{type:"express",name:r("express_delivery","Экспресс доставка"),description:r("express_description","Доставка в течение 2-4 часов"),cost:75e3,icon:"⚡"}],w=[{method:"card",name:r("card_payment","Банковская карта"),description:"Visa, MasterCard, UzCard",icon:"💳"},{method:"cash",name:r("cash_payment","Наличными курьеру"),description:r("cash_description","Оплата при получении"),icon:"💵"},{method:"online",name:r("online_payment","Онлайн платежи"),description:r("online_description","PayMe, Click, Payme"),icon:"📱"}];h.useEffect(()=>{if(!b){m("/login?redirect=/checkout");return}if(i.length===0){m("/cart");return}},[b,i.length,m]);const o=s=>new Intl.NumberFormat("uz-UZ").format(s)+" сум",t=(s,d,c)=>{A(x=>({...x,[s]:{...x[s],[d]:c}}))},D=()=>{l<4&&u(s=>s+1)},O=()=>{l>1&&u(s=>s-1)},k=s=>{switch(s){case 1:const{firstName:d,lastName:c,phone:x,city:z,street:H,house:F}=a.address;return d&&c&&x&&z&&H&&F;case 2:return a.delivery.type;case 3:if(a.payment.method==="card"){const{cardNumber:Z,cardName:$,cardExpiry:G,cardCvv:J}=a.payment;return Z&&$&&G&&J}return!0;default:return!0}},q=async()=>{v(!0);try{const s={items:i,address:a.address,delivery:a.delivery,payment:{method:a.payment.method},totalPrice:y()+a.delivery.cost,createdAt:new Date().toISOString()};console.log("Отправляем заказ:",s),await new Promise(c=>setTimeout(c,2e3));const d=JSON.parse(localStorage.getItem("orders")||"[]");d.push({...s,id:Date.now(),status:"pending"}),localStorage.setItem("orders",JSON.stringify(d)),P(),m("/order-success")}catch(s){console.error("Ошибка оформления заказа:",s),alert(r("order_error","Произошла ошибка при оформлении заказа"))}finally{v(!1)}};if(i.length===0)return null;const C=y(),g=a.delivery.cost,E=C+g;return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>m("/cart"),className:"flex items-center text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(M,{className:"mr-2"}),r("back_to_cart","Вернуться в корзину")]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r("checkout_title","Оформление заказа")})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:[{step:1,title:r("delivery_address","Адрес"),icon:Y},{step:2,title:r("delivery_method","Доставка"),icon:T},{step:3,title:r("payment_method","Оплата"),icon:U},{step:4,title:r("order_confirmation","Подтверждение"),icon:W}].map(({step:s,title:d,icon:c})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${l>=s?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:e.jsx(c,{className:"h-4 w-4"})}),e.jsx("span",{className:`ml-2 text-sm font-medium ${l>=s?"text-blue-600":"text-gray-600"}`,children:d}),s<4&&e.jsx("div",{className:`w-16 h-1 mx-4 ${l>s?"bg-blue-600":"bg-gray-200"}`})]},s))})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[l===1&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Адрес доставки"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Имя *"}),e.jsx("input",{type:"text",value:a.address.firstName,onChange:s=>t("address","firstName",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Фамилия *"}),e.jsx("input",{type:"text",value:a.address.lastName,onChange:s=>t("address","lastName",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Телефон *"}),e.jsx("input",{type:"tel",value:a.address.phone,onChange:s=>t("address","phone",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Город *"}),e.jsx("select",{value:a.address.city,onChange:s=>t("address","city",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:N.map(s=>e.jsx("option",{value:s.value,children:s.name},s.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Улица *"}),e.jsx("input",{type:"text",value:a.address.street,onChange:s=>t("address","street",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Дом *"}),e.jsx("input",{type:"text",value:a.address.house,onChange:s=>t("address","house",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Квартира"}),e.jsx("input",{type:"text",value:a.address.apartment,onChange:s=>t("address","apartment",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Комментарий для курьера"}),e.jsx("textarea",{value:a.address.comment,onChange:s=>t("address","comment",s.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Дополнительная информация для доставки..."})]})]})]}),l===2&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Способ доставки"}),e.jsx("div",{className:"space-y-4",children:f.map(s=>e.jsxs("label",{className:`block p-4 border rounded-lg cursor-pointer transition-colors ${a.delivery.type===s.type?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"delivery",value:s.type,checked:a.delivery.type===s.type,onChange:d=>{t("delivery","type",d.target.value),t("delivery","cost",s.cost)},className:"sr-only"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:s.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.description})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-medium text-gray-900",children:s.cost===0?"Бесплатно":o(s.cost)})})]})]},s.type))})]}),l===3&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Способ оплаты"}),e.jsx("div",{className:"space-y-4 mb-6",children:w.map(s=>e.jsxs("label",{className:`block p-4 border rounded-lg cursor-pointer transition-colors ${a.payment.method===s.method?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:s.method,checked:a.payment.method===s.method,onChange:d=>t("payment","method",d.target.value),className:"sr-only"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:s.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.description})]})]})]},s.method))}),a.payment.method==="card"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Данные банковской карты"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Номер карты *"}),e.jsx("input",{type:"text",value:a.payment.cardNumber,onChange:s=>t("payment","cardNumber",s.target.value),placeholder:"1234 5678 9012 3456",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Имя на карте *"}),e.jsx("input",{type:"text",value:a.payment.cardName,onChange:s=>t("payment","cardName",s.target.value),placeholder:"JOHN SMITH",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Срок действия *"}),e.jsx("input",{type:"text",value:a.payment.cardExpiry,onChange:s=>t("payment","cardExpiry",s.target.value),placeholder:"MM/YY",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CVV *"}),e.jsx("input",{type:"text",value:a.payment.cardCvv,onChange:s=>t("payment","cardCvv",s.target.value),placeholder:"123",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]})]})]}),l===4&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Подтверждение заказа"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Адрес доставки"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[a.address.firstName," ",a.address.lastName]}),e.jsx("p",{children:a.address.phone}),e.jsxs("p",{children:[(I=N.find(s=>s.value===a.address.city))==null?void 0:I.name,",",a.address.street,", д. ",a.address.house,a.address.apartment&&`, кв. ${a.address.apartment}`]})]}),e.jsxs("button",{onClick:()=>u(1),className:"text-blue-600 hover:text-blue-700 text-sm flex items-center mt-2",children:[e.jsx(p,{className:"mr-1 h-3 w-3"}),"Изменить"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Доставка"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:(_=f.find(s=>s.type===a.delivery.type))==null?void 0:_.name}),e.jsx("p",{children:o(a.delivery.cost)})]}),e.jsxs("button",{onClick:()=>u(2),className:"text-blue-600 hover:text-blue-700 text-sm flex items-center mt-2",children:[e.jsx(p,{className:"mr-1 h-3 w-3"}),"Изменить"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Оплата"}),e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("p",{children:(S=w.find(s=>s.method===a.payment.method))==null?void 0:S.name})}),e.jsxs("button",{onClick:()=>u(3),className:"text-blue-600 hover:text-blue-700 text-sm flex items-center mt-2",children:[e.jsx(p,{className:"mr-1 h-3 w-3"}),"Изменить"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("button",{onClick:O,disabled:l===1,className:`flex items-center px-4 py-2 rounded-lg transition-colors ${l===1?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(M,{className:"mr-2"}),r("previous_step","Назад")]}),l<4?e.jsx("button",{onClick:D,disabled:!k(l),className:`px-6 py-2 rounded-lg transition-colors ${k(l)?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:r("next_step","Далее")}):e.jsx("button",{onClick:q,disabled:j,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-300",children:j?r("processing","Оформляем..."):r("place_order","Оформить заказ")})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 sticky top-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Ваш заказ"}),e.jsx("div",{className:"space-y-3 mb-4",children:i.map(s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:s.image||"/images/placeholder-product.jpg",alt:s.title,className:"w-12 h-12 object-cover rounded",onError:d=>{d.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yNCAxNkwyNCAzMk0xNiAyNEwzMiAyNCIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.quantity," шт. × ",o(s.price)]})]})]},s.id))}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Товары (",i.length,")"]}),e.jsx("span",{children:o(C)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Доставка"}),e.jsx("span",{children:g===0?"Бесплатно":o(g)})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[e.jsx("span",{children:"Итого"}),e.jsx("span",{children:o(E)})]})]})]})})]})]})})};export{K as default};
