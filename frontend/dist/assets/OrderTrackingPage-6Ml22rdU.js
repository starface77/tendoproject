import{a as I,u as _,r as n,E as C,G as q,j as e,U as l,q as S,e as E,n as H,H as R,P as h,X as k,F as $,W as A,l as M}from"./index-U3rPQCjX.js";const O=()=>{var f,v;const{orderId:c}=I(),{t:G}=_(),[t,p]=n.useState(null),[d,u]=n.useState(null),[F,g]=n.useState(!0),[b,y]=n.useState("");n.useEffect(()=>{o()},[c]);const o=async()=>{g(!0),y("");try{try{const s=await C.orders.getOrderById(c);s.success&&p(s.data);const a=await q.getPaymentStatus(c);a.success&&u(a.data)}catch{console.log("API не отвечает, используем демо данные");const a={_id:c,orderNumber:"TMD"+Date.now().toString().slice(-6),createdAt:new Date(Date.now()-4*24*60*60*1e3),updatedAt:new Date(Date.now()-6*60*60*1e3),items:[{productSnapshot:{name:{ru:"iPhone 15 Pro Max 256GB",uz:"iPhone 15 Pro Max 256GB",en:"iPhone 15 Pro Max 256GB"},image:"https://images.unsplash.com/photo-1592899677977-9c10ca588bbd?w=300&h=300&fit=crop",sku:"IPH15PM256"},quantity:1,price:1599e4},{productSnapshot:{name:{ru:"AirPods Pro 2 с активным шумоподавлением",uz:"AirPods Pro 2",en:"AirPods Pro 2"},image:"https://images.unsplash.com/photo-1572569511254-d8f925fe2cbb?w=300&h=300&fit=crop",sku:"APP2"},quantity:2,price:349e4},{productSnapshot:{name:{ru:'MacBook Air M2 13" 256GB',uz:"MacBook Air M2",en:"MacBook Air M2"},image:"https://images.unsplash.com/photo-1517336714731-489689fd1ca4?w=300&h=300&fit=crop",sku:"MBA13M2"},quantity:1,price:2299e4}],totalAmount:4597e4,shippingAddress:{city:"Ташкент",district:"Мирзо-Улугбекский район",street:"ул. Амира Темура",building:"42",apartment:"15",floor:"3",entrance:"2"},delivery:{method:"standard",cost:5e4,estimatedDate:new Date(Date.now()+1*24*60*60*1e3),trackingNumber:"TM24"+Date.now().toString().slice(-8),courier:{name:"Алишер Каримов",phone:"+998901111111",rating:4.8}},status:"out_for_delivery",paymentStatus:"paid",paymentMethod:"payme",statusHistory:[{status:"pending",date:new Date(Date.now()-4*24*60*60*1e3),notes:"Заказ создан и ожидает обработки"},{status:"confirmed",date:new Date(Date.now()-3*24*60*60*1e3),notes:"Заказ подтвержден менеджером"},{status:"processing",date:new Date(Date.now()-2*24*60*60*1e3),notes:"Заказ передан в обработку на склад"},{status:"packed",date:new Date(Date.now()-1*24*60*60*1e3),notes:"Товары упакованы и готовы к отправке"},{status:"shipped",date:new Date(Date.now()-8*60*60*1e3),notes:"Заказ передан курьерской службе"},{status:"out_for_delivery",date:new Date(Date.now()-2*60*60*1e3),notes:"Курьер выехал для доставки. Ожидайте звонка!"}]},r={paymentStatus:"paid",orderId:c};p(a),u(r)}}catch(s){console.error("Ошибка загрузки данных заказа:",s),y("Не удалось загрузить информацию о заказе")}finally{g(!1)}},j=s=>{const a={pending:{label:"Ожидает обработки",color:"text-yellow-600 bg-yellow-50",icon:k},confirmed:{label:"Подтвержден",color:"text-blue-600 bg-blue-50",icon:A},processing:{label:"В обработке",color:"text-blue-600 bg-blue-50",icon:l},packed:{label:"Упакован",color:"text-purple-600 bg-purple-50",icon:l},shipped:{label:"Отправлен",color:"text-indigo-600 bg-indigo-50",icon:M},out_for_delivery:{label:"В доставке",color:"text-orange-600 bg-orange-50",icon:M},delivered:{label:"Доставлен",color:"text-green-600 bg-green-50",icon:A},cancelled:{label:"Отменен",color:"text-red-600 bg-red-50",icon:$}};return a[s]||a.pending},B=s=>{const a={pending:{label:"Ожидает оплаты",color:"text-yellow-600 bg-yellow-50"},processing:{label:"Обрабатывается",color:"text-blue-600 bg-blue-50"},paid:{label:"Оплачен",color:"text-green-600 bg-green-50"},failed:{label:"Ошибка оплаты",color:"text-red-600 bg-red-50"},cancelled:{label:"Отменен",color:"text-gray-600 bg-gray-50"}};return a[s]||a.pending},m=s=>new Intl.NumberFormat("ru-RU").format(s)+" сум",i=s=>new Date(s).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});if(F)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center pb-28 sm:pb-6",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Загрузка информации о заказе..."})]})});if(b)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center pb-28 sm:pb-6",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 text-red-500",children:e.jsx(l,{className:"w-full h-full"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Ошибка загрузки"}),e.jsx("p",{className:"text-gray-600 mb-6",children:b}),e.jsx("button",{onClick:o,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Попробовать снова"})]})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center pb-28 sm:pb-6",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 text-gray-400",children:e.jsx(l,{className:"w-full h-full"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Заказ не найден"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Проверьте правильность номера заказа"}),e.jsx(S,{to:"/orders",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Мои заказы"})]})});const x=j(t.status),N=B((d==null?void 0:d.paymentStatus)||t.paymentStatus||"pending");return e.jsx("div",{className:"min-h-screen bg-gray-50 py-6 pb-28 sm:pb-6",children:e.jsxs("div",{className:"container-custom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(S,{to:"/orders",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:["Заказ #",t.orderNumber||((f=t._id)==null?void 0:f.slice(-8))]}),e.jsxs("p",{className:"text-gray-600",children:["Создан ",i(t.createdAt)]})]})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(H,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Статус заказа"}),e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:`p-3 rounded-lg ${x.color}`,children:e.jsx(x.icon,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:x.label}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Последнее обновление: ",i(t.updatedAt)]})]})]}),t.statusHistory&&t.statusHistory.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"История статусов"}),e.jsx("div",{className:"space-y-3",children:t.statusHistory.slice().reverse().map((s,a)=>{const r=j(s.status);return e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${r.color}`,children:e.jsx(r.icon,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.label}),e.jsx("p",{className:"text-sm text-gray-600",children:i(s.date)}),s.notes&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.notes})]})]},a)})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Товары в заказе"}),e.jsx("div",{className:"space-y-4",children:(v=t.items)==null?void 0:v.map((s,a)=>{var r,w,P,D;return e.jsxs("div",{className:"flex items-center space-x-4 py-3 border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex-shrink-0",children:(r=s.productSnapshot)!=null&&r.image?e.jsx("img",{src:s.productSnapshot.image,alt:((w=s.productSnapshot.name)==null?void 0:w.ru)||"Product",className:"w-full h-full object-cover rounded-lg"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(l,{className:"h-6 w-6 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:((D=(P=s.productSnapshot)==null?void 0:P.name)==null?void 0:D.ru)||s.name||"Товар"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Количество: ",s.quantity," шт."]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:m(s.price*s.quantity)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m(s.price)," за шт."]})]})]},a)})})]}),t.delivery&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Доставка"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Адрес доставки"}),e.jsx("p",{className:"text-gray-600 text-sm",children:t.shippingAddress?`${t.shippingAddress.city}, ${t.shippingAddress.street}, ${t.shippingAddress.building}`:"Адрес не указан"})]})]}),t.delivery.trackingNumber&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(l,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Трек-номер"}),e.jsx("p",{className:"text-blue-600 text-sm font-mono",children:t.delivery.trackingNumber})]})]}),t.delivery.courier&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Курьер"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[t.delivery.courier.name," - ",t.delivery.courier.phone]})]})]}),t.delivery.estimatedDate&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Ожидаемая дата доставки"}),e.jsx("p",{className:"text-gray-600 text-sm",children:i(t.delivery.estimatedDate)})]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Оплата"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Статус оплаты:"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${N.color}`,children:N.label})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Способ оплаты:"}),e.jsx("span",{className:"font-medium",children:t.paymentMethod==="payme"?"Payme":t.paymentMethod==="click"?"Click":t.paymentMethod||"Не указан"})]}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[e.jsx("span",{children:"Итого:"}),e.jsx("span",{children:m(t.totalAmount)})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Нужна помощь?"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"h-4 w-4 text-gray-400"}),e.jsx("a",{href:"tel:+998781501515",className:"text-blue-600 hover:text-blue-700",children:"+998 78 150 15 15"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Круглосуточно"})]})]})]})]})]})]})})};export{O as default};
